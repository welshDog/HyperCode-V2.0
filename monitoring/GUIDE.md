# ðŸ§  HyperCode Prometheus Mastery Guide

> **Objective**: Turn the development team into Observability Warlords.
> **Stack**: Prometheus, Grafana, AlertManager, NodeExporter, cAdvisor.

---

## 1. The Theory (Why do we care?)
Monitoring is not just "looking at graphs." It is the **nervous system** of your application.
- **Metrics (Prometheus)**: "What is happening right now?" (e.g., CPU is at 80%).
- **Logs (Loki - Future)**: "Why did it happen?" (e.g., NullReferenceException).
- **Traces (Jaeger - Future)**: "Where did it happen?" (e.g., Database query took 5s).
- **Alerts (AlertManager)**: "Wake me up because it's broken."

## 2. The Stack Architecture
We are running a **Decoupled Monitoring Stack**. It lives on the `hypercode_hypernet` network but in its own `docker-compose.monitoring.yml` file.

| Service | Port | Role |
|:---|:---|:---|
| **Prometheus** | `:9090` | The Brain. Scrapes metrics from everyone else. |
| **Grafana** | `:3001` | The Face. Visualizes the data. (User: `admin` / Pass: `admin`) |
| **AlertManager** | `:9093` | The Town Crier. Handles alerts sent by Prometheus. |
| **Node Exporter** | `:9100` | The Doctor. Reports host (VM) hardware stats. |
| **cAdvisor** | `:8080` | The Container Spy. Reports resource usage per container. |
| **Blackbox Exp** | `:9115` | The Pinger. Checks if endpoints (API, Health) are reachable. |

## 3. Hands-On Setup ðŸ› ï¸

### Prerequisite
Ensure the core network exists (usually created by the main stack):
```bash
docker network create hypercode_hypernet
```

### Launch the Stack
Run this command from the project root:
```bash
docker-compose -f docker-compose.monitoring.yml up -d
```

### Verification
1. **Prometheus**: Visit [http://localhost:9090](http://localhost:9090).
   - Go to **Status > Targets**. All endpoints should be **UP**.
2. **Grafana**: Visit [http://localhost:3001](http://localhost:3001).
   - Login with `admin` / `admin`.
   - Add Data Source: Choose **Prometheus**.
   - URL: `http://prometheus:9090`.
   - Click **Save & Test**.

## 4. PromQL Cheat Sheet (Copy-Paste Magic) ðŸ§™â€â™‚ï¸

**Basic Health Check:**
```promql
up
```
*Returns 1 if the target is up, 0 if down.*

**Container CPU Usage (Top 5):**
```promql
topk(5, rate(container_cpu_usage_seconds_total[5m]))
```

**Memory Usage by Container Name:**
```promql
sum(container_memory_usage_bytes) by (name)
```

**HTTP Error Rate (requires custom app metrics):**
```promql
rate(http_requests_total{status=~"5.."}[5m])
```

## 5. Next Steps
- **Import Dashboards**: Go to Grafana > Dashboards > Import. Use ID `1860` for a great Node Exporter dashboard or `14282` for cAdvisor.
- **Silence Alerts**: Go to [http://localhost:9093](http://localhost:9093) to manage silences during maintenance.

---
*Generated by Trae - HyperCode DevOps Assistant*
