============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-8.4.1, pluggy-1.6.0 -- C:\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Lyndz\Downloads\HyperCode-V2.0\THE HYPERCODE\hypercode-core
configfile: pytest.ini
testpaths: tests
plugins: asyncio-1.3.0, anyio-4.9.0, cov-4.1.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 199 items

tests/e2e/test_integration_bridge.py::test_agent_registration_e2e PASSED [  0%]
tests/e2e/test_integration_bridge.py::test_mission_submission_e2e PASSED [  1%]
tests/e2e/test_integration_bridge.py::test_telemetry_aggregation_e2e PASSED [  1%]
tests/perf/test_engine_latency.py::test_engine_run_latency_distribution PASSED [  2%]
tests/perf/test_interpreter_perf.py::test_perf_simple_loop_under_threshold PASSED [  2%]
tests/unit/test_agent_registry_acceptance.py::test_duplicate_payload_returns_200 PASSED [  3%]
tests/unit/test_agent_registry_acceptance.py::test_immutable_role_change_rejected_422 PASSED [  3%]
tests/unit/test_agent_registry_acceptance.py::test_version_minor_bumps_and_patch_resets_on_dedup_re_register PASSED [  4%]
tests/unit/test_agent_registry_coverage.py::test_register_agent_new PASSED [  4%]
tests/unit/test_agent_registry_coverage.py::test_register_agent_update PASSED [  5%]
tests/unit/test_agent_registry_coverage.py::test_register_agent_immutable_role_error PASSED [  5%]
tests/unit/test_agent_registry_coverage.py::test_get_agent_cache_hit PASSED [  6%]
tests/unit/test_agent_registry_coverage.py::test_get_agent_db_hit PASSED [  6%]
tests/unit/test_agent_registry_coverage.py::test_deregister_agent PASSED [  7%]
tests/unit/test_agent_registry_coverage.py::test_check_timeouts PASSED   [  7%]
tests/unit/test_agent_registry_idempotent.py::test_sse_stream_endpoint_available PASSED [  8%]
tests/unit/test_agent_registry_idempotent.py::test_idempotent_registration_by_dedup_key PASSED [  8%]
tests/unit/test_agent_registry_idempotent.py::test_metrics_exposed PASSED [  9%]
tests/unit/test_agents.py::test_register_agent PASSED                    [  9%]
tests/unit/test_agents.py::test_get_agents PASSED                        [ 10%]
tests/unit/test_agents.py::test_heartbeat PASSED                         [ 10%]
tests/unit/test_agents.py::test_sse_stream_endpoint_sync PASSED          [ 11%]
tests/unit/test_agents_coverage.py::test_deregister_agent PASSED         [ 11%]
tests/unit/test_agents_coverage.py::test_heartbeat_not_found PASSED      [ 12%]
tests/unit/test_agents_coverage.py::test_get_agents_list PASSED          [ 12%]
tests/unit/test_agents_coverage.py::test_register_agent_success PASSED   [ 13%]
tests/unit/test_agents_coverage.py::test_watch_agents_endpoint PASSED    [ 13%]
tests/unit/test_agents_coverage.py::test_get_agent_details PASSED        [ 14%]
tests/unit/test_agents_coverage.py::test_get_agent_details_not_found PASSED [ 14%]
tests/unit/test_agents_coverage.py::test_send_task_not_connected PASSED  [ 15%]
tests/unit/test_agents_coverage.py::test_send_task_success PASSED        [ 15%]
tests/unit/test_auth_config.py::test_security_validation_dev PASSED      [ 16%]
tests/unit/test_auth_config.py::test_security_validation_prod_missing PASSED [ 16%]
tests/unit/test_auth_config.py::test_security_validation_prod_short PASSED [ 17%]
tests/unit/test_auth_config.py::test_security_validation_prod_valid PASSED [ 17%]
tests/unit/test_auth_coverage.py::test_verify_api_key_valid PASSED       [ 18%]
tests/unit/test_auth_coverage.py::test_verify_api_key_invalid PASSED     [ 18%]
tests/unit/test_auth_coverage.py::test_verify_api_key_missing_key_provided_none PASSED [ 19%]
tests/unit/test_auth_coverage.py::test_verify_api_key_missing_settings_key_prod PASSED [ 19%]
tests/unit/test_auth_coverage.py::test_verify_api_key_missing_settings_key_local PASSED [ 20%]
tests/unit/test_auth_coverage.py::test_get_current_user_no_token PASSED  [ 20%]
tests/unit/test_auth_coverage.py::test_get_current_user_valid_token_no_scopes PASSED [ 21%]
tests/unit/test_auth_coverage.py::test_get_current_user_valid_token_with_scopes PASSED [ 21%]
tests/unit/test_auth_coverage.py::test_get_current_user_missing_scopes PASSED [ 22%]
tests/unit/test_auth_coverage.py::test_get_current_user_invalid_token PASSED [ 22%]
tests/unit/test_auth_coverage.py::test_get_current_user_missing_public_key_prod PASSED [ 23%]
tests/unit/test_auth_coverage.py::test_get_current_user_missing_public_key_local PASSED [ 23%]
tests/unit/test_auth_rbac.py::test_auth_missing_credentials PASSED       [ 24%]
tests/unit/test_auth_rbac.py::test_auth_valid_api_key PASSED             [ 24%]
tests/unit/test_auth_rbac.py::test_auth_invalid_api_key PASSED           [ 25%]
tests/unit/test_circuit_breaker.py::test_circuit_breaker_opens_after_failures PASSED [ 25%]
tests/unit/test_collaboration_efficiency.py::test_agents_collaboration_register_list_heartbeat PASSED [ 26%]
tests/unit/test_dashboard_router.py::test_dashboard_websocket_flow PASSED [ 26%]
tests/unit/test_dashboard_router.py::test_dashboard_websocket_partial_failure PASSED [ 27%]
tests/unit/test_dashboard_router.py::test_dashboard_websocket_disconnect_handling PASSED [ 27%]
tests/unit/test_dlq_consumer.py::test_dlq_publish_and_persist PASSED     [ 28%]
tests/unit/test_engine_adapter.py::test_adapter_api_path PASSED          [ 28%]
tests/unit/test_engine_adapter.py::test_adapter_cli_path PASSED          [ 29%]
tests/unit/test_engine_adapter_payload.py::test_adapter_forwards_env_and_target PASSED [ 29%]
tests/unit/test_engine_run_route.py::test_engine_run_route PASSED        [ 30%]
tests/unit/test_error_handling.py::test_agent_register_role_change_422 PASSED [ 30%]
tests/unit/test_error_handling.py::test_execution_error_status PASSED    [ 31%]
tests/unit/test_event_bus.py::test_publish_subscribe_roundtrip PASSED    [ 31%]
tests/unit/test_event_bus_enhanced.py::test_publish_calls_redis PASSED   [ 32%]
tests/unit/test_event_bus_enhanced.py::test_publish_stream_calls_xadd PASSED [ 32%]
tests/unit/test_event_bus_enhanced.py::test_create_consumer_group PASSED [ 33%]
tests/unit/test_event_bus_enhanced.py::test_consume_stream FAILED        [ 33%]
tests/unit/test_execute_hc.py::test_execute_hc_eval_print PASSED         [ 34%]
tests/unit/test_execute_hc_file.py::test_execute_hc_file_run PASSED      [ 34%]
tests/unit/test_execution_service_coverage.py::test_execute_python_success PASSED [ 35%]
tests/unit/test_execution_service_coverage.py::test_execute_python_timeout PASSED [ 35%]
tests/unit/test_execution_service_coverage.py::test_execute_bash_simple PASSED [ 36%]
tests/unit/test_execution_service_coverage.py::test_execute_bash_python_unwrap PASSED [ 36%]
tests/unit/test_execution_service_coverage.py::test_execute_hypercode_with_target PASSED [ 37%]
tests/unit/test_execution_service_coverage.py::test_execute_hypercode_direct PASSED [ 37%]
tests/unit/test_execution_service_coverage.py::test_execution_exception PASSED [ 38%]
tests/unit/test_hc_parser.py::test_parse_hc_mission_block PASSED         [ 38%]
tests/unit/test_health.py::test_health_check PASSED                      [ 39%]
tests/unit/test_heartbeat_lifecycle.py::test_heartbeat_full_lifecycle PASSED [ 39%]
tests/unit/test_heartbeat_lifecycle.py::test_timeout_marks_offline PASSED [ 40%]
tests/unit/test_hypercode_cli_target.py::test_cli_includes_target_flag PASSED [ 40%]
tests/unit/test_immutable_error_payload.py::test_immutable_role_error_payload PASSED [ 41%]
tests/unit/test_interpreter_constructs.py::test_if_else PASSED           [ 41%]
tests/unit/test_interpreter_constructs.py::test_while_loop_break PASSED  [ 42%]
tests/unit/test_interpreter_constructs.py::test_for_loop_continue PASSED [ 42%]
tests/unit/test_interpreter_constructs.py::test_function_decl_and_call PASSED [ 43%]
tests/unit/test_interpreter_constructs.py::test_scoping_variables PASSED [ 43%]
tests/unit/test_interpreter_constructs.py::test_operators_and_expressions PASSED [ 44%]
tests/unit/test_interpreter_errors.py::test_undefined_name_error PASSED  [ 44%]
tests/unit/test_interpreter_errors.py::test_unsupported_node_error PASSED [ 45%]
tests/unit/test_interpreter_metrics.py::test_interpreter_metrics_success_exposed PASSED [ 45%]
tests/unit/test_interpreter_metrics.py::test_interpreter_metrics_error_exposed PASSED [ 46%]
tests/unit/test_key_manager.py::test_generate_list_validate_revoke PASSED [ 46%]
tests/unit/test_key_manager.py::test_api_key_fallback PASSED             [ 47%]
tests/unit/test_llm_factory.py::test_factory_default_ollama PASSED       [ 47%]
tests/unit/test_llm_factory.py::test_factory_openai PASSED               [ 48%]
tests/unit/test_llm_factory.py::test_llm_service_delegation PASSED       [ 48%]
tests/unit/test_llm_factory.py::test_ollama_provider_generate PASSED     [ 49%]
tests/unit/test_llm_factory.py::test_openai_provider_generate PASSED     [ 49%]
tests/unit/test_llm_service_coverage.py::test_llm_service_init_defaults FAILED [ 50%]
tests/unit/test_llm_service_coverage.py::test_llm_service_init_custom PASSED [ 50%]
tests/unit/test_llm_service_coverage.py::test_generate_disabled PASSED   [ 51%]
tests/unit/test_llm_service_coverage.py::test_generate_ollama_success PASSED [ 51%]
tests/unit/test_llm_service_coverage.py::test_generate_ollama_connection_error PASSED [ 52%]
tests/unit/test_llm_service_coverage.py::test_generate_openai_not_implemented PASSED [ 52%]
tests/unit/test_llm_service_coverage.py::test_generate_unknown_provider PASSED [ 53%]
tests/unit/test_llm_service_coverage.py::test_health_check_healthy PASSED [ 53%]
tests/unit/test_llm_service_coverage.py::test_health_check_unhealthy PASSED [ 54%]
tests/unit/test_llm_service_coverage.py::test_health_check_disabled PASSED [ 54%]
tests/unit/test_memory_redis.py::test_create_memory_caching PASSED       [ 55%]
tests/unit/test_memory_redis.py::test_get_memory_cache_hit PASSED        [ 55%]
tests/unit/test_memory_redis.py::test_get_memory_cache_miss PASSED       [ 56%]
tests/unit/test_memory_redis.py::test_delete_memory_clears_cache PASSED  [ 56%]
tests/unit/test_memory_router.py::test_create_memory PASSED              [ 57%]
tests/unit/test_memory_router.py::test_search_memories PASSED            [ 57%]
tests/unit/test_memory_router.py::test_get_memory_found PASSED           [ 58%]
tests/unit/test_memory_router.py::test_get_memory_not_found PASSED       [ 58%]
tests/unit/test_memory_router.py::test_update_memory PASSED              [ 59%]
tests/unit/test_memory_router.py::test_update_memory_not_found PASSED    [ 59%]
tests/unit/test_memory_router.py::test_delete_memory PASSED              [ 60%]
tests/unit/test_memory_router.py::test_delete_memory_not_found PASSED    [ 60%]
tests/unit/test_memory_router.py::test_cleanup_memories PASSED           [ 61%]
tests/unit/test_memory_service.py::test_memory_crud_and_search PASSED    [ 61%]
tests/unit/test_memory_service.py::test_memory_cleanup_expired PASSED    [ 62%]
tests/unit/test_memory_vector.py::test_cosine_similarity PASSED          [ 62%]
tests/unit/test_memory_vector.py::test_search_similar PASSED             [ 63%]
tests/unit/test_metrics_latency.py::test_stream_latency_metric_observed PASSED [ 63%]
tests/unit/test_metrics_router.py::test_get_costs PASSED                 [ 64%]
tests/unit/test_metrics_router.py::test_performance_metrics PASSED       [ 64%]
tests/unit/test_metrics_router.py::test_error_metrics PASSED             [ 65%]
tests/unit/test_metrics_router.py::test_execution_metrics PASSED         [ 65%]
tests/unit/test_metrics_router.py::test_execution_metrics_empty PASSED   [ 66%]
tests/unit/test_metrics_router.py::test_resource_metrics PASSED          [ 66%]
tests/unit/test_metrics_router.py::test_agent_stream_summary PASSED      [ 67%]
tests/unit/test_metrics_router.py::test_agent_stream_summary_error PASSED [ 67%]
tests/unit/test_mission_flow_report.py::test_mission_flow_and_report PASSED [ 68%]
tests/unit/test_mission_lifecycle.py::test_mission_full_lifecycle PASSED [ 68%]
tests/unit/test_nd_errors.py::test_undefined_name_error_with_suggestions PASSED [ 69%]
tests/unit/test_nd_errors.py::test_syntax_error_formatting PASSED        [ 69%]
tests/unit/test_nd_errors.py::test_type_error_explanation PASSED         [ 70%]
tests/unit/test_nd_errors.py::test_unsupported_feature_helpful PASSED    [ 70%]
tests/unit/test_nd_errors.py::test_similar_names_detection PASSED        [ 71%]
tests/unit/test_orchestrator_coverage.py::test_submit_mission PASSED     [ 71%]
tests/unit/test_orchestrator_coverage.py::test_assign_next_no_missions PASSED [ 72%]
tests/unit/test_orchestrator_coverage.py::test_assign_next_success PASSED [ 72%]
tests/unit/test_orchestrator_coverage.py::test_assign_next_no_matching_agent PASSED [ 73%]
tests/unit/test_orchestrator_coverage.py::test_ensure_redis_fallback PASSED [ 73%]
tests/unit/test_orchestrator_extended.py::test_list_missions PASSED      [ 74%]
tests/unit/test_orchestrator_extended.py::test_list_missions_with_error PASSED [ 74%]
tests/unit/test_orchestrator_extended.py::test_audit_retry_logic PASSED  [ 75%]
tests/unit/test_orchestrator_extended.py::test_audit_failure PASSED      [ 75%]
tests/unit/test_orchestrator_extended.py::test_approve_mission PASSED    [ 76%]
tests/unit/test_orchestrator_extended.py::test_approve_mission_not_found PASSED [ 76%]
tests/unit/test_orchestrator_mission_api.py::test_create_mission_success PASSED [ 77%]
tests/unit/test_orchestrator_mission_api.py::test_create_mission_invalid_payload PASSED [ 77%]
tests/unit/test_orchestrator_mission_api.py::test_submit_mission_report_success PASSED [ 78%]
tests/unit/test_orchestrator_mission_api.py::test_submit_mission_report_failure PASSED [ 78%]
tests/unit/test_orchestrator_mission_api.py::test_submit_mission_report_not_found PASSED [ 79%]
tests/unit/test_orchestrator_mission_api.py::test_get_mission_audit_trail_success PASSED [ 79%]
tests/unit/test_orchestrator_mission_api.py::test_get_mission_audit_trail_not_found PASSED [ 80%]
tests/unit/test_orchestrator_mission_api.py::test_assign_task_to_agent PASSED [ 80%]
tests/unit/test_orchestrator_mission_api.py::test_mission_completion_flow PASSED [ 81%]
tests/unit/test_orchestrator_mission_api.py::test_mission_not_found_scenarios PASSED [ 81%]
tests/unit/test_orchestrator_mission_api.py::test_concurrent_mission_handling PASSED [ 82%]
tests/unit/test_orchestrator_selection.py::test_orchestrator_assign_prefers_capability_and_health PASSED [ 82%]
tests/unit/test_parser.py::test_parse_hello_world PASSED                 [ 83%]
tests/unit/test_parser.py::test_parse_assignment PASSED                  [ 83%]
tests/unit/test_parser.py::test_parse_function_def PASSED                [ 84%]
tests/unit/test_rate_limit.py::test_rate_limiter_redis_allowed PASSED    [ 84%]
tests/unit/test_rate_limit.py::test_rate_limiter_redis_blocked PASSED    [ 85%]
tests/unit/test_rate_limit.py::test_rate_limiter_fallback PASSED         [ 85%]
tests/unit/test_rate_limit.py::test_check_rate_limit_dependency PASSED   [ 86%]
tests/unit/test_report_endpoint.py::test_report_endpoint_success PASSED  [ 86%]
tests/unit/test_report_endpoint.py::test_report_endpoint_error PASSED    [ 87%]
tests/unit/test_report_endpoint.py::test_report_endpoint_invalid_json PASSED [ 87%]
tests/unit/test_retry_backoff.py::test_schedule_retry_exponential_backoff_and_jitter PASSED [ 88%]
tests/unit/test_retry_backoff.py::test_max_retries_prevents_scheduling PASSED [ 88%]
tests/unit/test_retry_integration.py::test_retry_flow_schedules_and_requeues PASSED [ 89%]
tests/unit/test_role_immutability.py::test_role_change_with_same_dedup_key_returns_422[worker-architect] PASSED [ 89%]
tests/unit/test_role_immutability.py::test_role_change_with_same_dedup_key_returns_422[Worker-architect] PASSED [ 90%]
tests/unit/test_role_immutability.py::test_role_change_with_same_dedup_key_returns_422[worker-Architect] PASSED [ 90%]
tests/unit/test_role_immutability.py::test_case_only_role_is_considered_same PASSED [ 91%]
tests/unit/test_services_event_bus.py::test_publish_subscribe_envelope_roundtrip PASSED [ 91%]
tests/unit/test_simulator_router.py::test_simulator_status PASSED        [ 92%]
tests/unit/test_simulator_router.py::test_simulator_start_stop PASSED    [ 92%]
tests/unit/test_simulator_router.py::test_simulator_loop PASSED          [ 93%]
tests/unit/test_sse_emission.py::test_sse_emits_valid_messages PASSED    [ 93%]
tests/unit/test_sse_emission.py::test_sse_handles_malformed_data PASSED  [ 94%]
tests/unit/test_sse_emission.py::test_sse_high_frequency PASSED          [ 94%]
tests/unit/test_sse_emission.py::test_sse_connection_recovers PASSED     [ 95%]
tests/unit/test_sse_resilience.py::test_sse_handles_cancelled_error PASSED [ 95%]
tests/unit/test_sse_resilience.py::test_sse_pubsub_failure_does_not_500 PASSED [ 96%]
tests/unit/test_sse_stability.py::test_sse_stream_connects_with_backoff PASSED [ 96%]
tests/unit/test_sse_stability.py::test_metrics_endpoint_exposes_sse_metrics PASSED [ 97%]
tests/unit/test_voice_service.py::test_dc_offset_filter_reduces_offset PASSED [ 97%]
tests/unit/test_voice_service.py::test_agc_scales_signal PASSED          [ 98%]
tests/unit/test_voice_service.py::test_audio_buffer_window_and_transcribe PASSED [ 98%]
tests/unit/test_voice_ws.py::test_voice_ws_text_flow_dev_auth_disabled PASSED [ 99%]
tests/unit/test_voice_ws.py::test_voice_ws_rate_limit PASSED             [100%]

================================== FAILURES ===================================
_____________________________ test_consume_stream _____________________________
tests\unit\test_event_bus_enhanced.py:84: in test_consume_stream
    assert payload["payload"] == {"a": 1}
           ^^^^^^^^^^^^^^^^^^
E   KeyError: 'payload'
_______________________ test_llm_service_init_defaults ________________________
tests\unit\test_llm_service_coverage.py:47: in test_llm_service_init_defaults
    assert isinstance(service.provider, OllamaProvider)
E   assert False
E    +  where False = isinstance(<app.services.llm.perplexity.PerplexityProvider object at 0x000001594C0DE510>, OllamaProvider)
E    +    where <app.services.llm.perplexity.PerplexityProvider object at 0x000001594C0DE510> = <app.services.llm_service.LLMService object at 0x000001594D2909D0>.provider
============================== warnings summary ===============================
app\core\config.py:6
  C:\Users\Lyndz\Downloads\HyperCode-V2.0\THE HYPERCODE\hypercode-core\app\core\config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Settings(BaseSettings):

app\schemas\agent.py:17
  C:\Users\Lyndz\Downloads\HyperCode-V2.0\THE HYPERCODE\hypercode-core\app\schemas\agent.py:17: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgentMetadata(BaseModel):

app\schemas\memory.py:24
  C:\Users\Lyndz\Downloads\HyperCode-V2.0\THE HYPERCODE\hypercode-core\app\schemas\memory.py:24: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class MemoryResponse(MemoryBase):

app\services\memory_service.py:19
  C:\Users\Lyndz\Downloads\HyperCode-V2.0\THE HYPERCODE\hypercode-core\app\services\memory_service.py:19: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Memory(BaseModel):

..\..\..\..\..\..\Python313\Lib\site-packages\fastapi\applications.py:1051
  C:\Python313\Lib\site-packages\fastapi\applications.py:1051: PytestCollectionWarning: cannot collect 'test_app' because it is not a function.
    async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:

tests/perf/test_interpreter_perf.py: 3 warnings
tests/unit/test_interpreter_constructs.py: 16 warnings
tests/unit/test_parser.py: 1 warning
  C:\Users\Lyndz\Downloads\HyperCode-V2.0\THE HYPERCODE\hypercode-core\app\parser\hc_parser.py:332: DeprecationWarning: ast.Str is deprecated and will be removed in Python 3.14; use ast.Constant instead
    if isinstance(node, ast.Str):

tests/perf/test_interpreter_perf.py: 3 warnings
tests/unit/test_interpreter_constructs.py: 16 warnings
tests/unit/test_parser.py: 1 warning
  C:\Users\Lyndz\Downloads\HyperCode-V2.0\THE HYPERCODE\hypercode-core\app\parser\hc_parser.py:334: DeprecationWarning: ast.Num is deprecated and will be removed in Python 3.14; use ast.Constant instead
    if isinstance(node, ast.Num):

tests/unit/test_execution_service_coverage.py::test_execute_python_timeout
  C:\Users\Lyndz\Downloads\HyperCode-V2.0\THE HYPERCODE\hypercode-core\app\services\execution_service.py:67: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    process.kill()
  
  Object allocated at:
    File "C:\Python313\Lib\unittest\mock.py", line 1173
      return self._execute_mock_call(*args, **kwargs)

tests/unit/test_memory_redis.py::test_get_memory_cache_hit
  C:\Users\Lyndz\Downloads\HyperCode-V2.0\THE HYPERCODE\hypercode-core\app\services\memory_service.py:251: PydanticDeprecatedSince20: The `parse_obj` method is deprecated; use `model_validate` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    return Memory.parse_obj(cached)

tests/unit/test_services_event_bus.py::test_publish_subscribe_envelope_roundtrip
  C:\Users\Lyndz\Downloads\HyperCode-V2.0\THE HYPERCODE\hypercode-core\app\services\event_bus.py:264: DeprecationWarning: Call to deprecated close. (Use aclose() instead) -- Deprecated since version 5.0.1.
    await pubsub.close()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform win32, python 3.13.5-final-0 -----------
Name                                        Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------------------
app\core\auth.py                               45      3     26      3    92%   44, 55, 85
app\core\celery_app.py                          9      3      2      1    64%   8-10
app\core\config.py                             54      2     12      1    95%   73->78, 76-77
app\core\db.py                                  4      1      0      0    75%   5
app\core\logging.py                            22      1      4      1    92%   36
app\engine\adapter.py                          57     11      8      0    83%   48-51, 65-69, 71-72
app\engine\cli.py                              35      7      8      3    72%   9, 24-25, 31-34, 38->exit
app\engine\interpreter.py                     231     52    148     22    73%   70, 76-77, 109->107, 125, 133-134, 136, 142, 143->145, 149, 153, 159-169, 179, 189-190, 196, 212-217, 222, 225-227, 238, 241-248, 256, 265, 268-274
app\errors\nd_errors.py                        82      4     38      7    91%   30->33, 34, 35->37, 50, 149->152, 153, 155
app\middleware\budget_guard.py                 53     36     16      0    25%   34-47, 54-80, 89-100
app\middleware\rate_limit.py                   62      4     12      1    93%   52-54, 101
app\parser\hc_parser.py                       314     26    126     19    88%   69-71, 101-102, 123->125, 146->148, 153, 161->159, 168, 179-180, 189->187, 233->238, 243, 249, 301-307, 316, 322-324, 333, 335, 339, 363
app\routers\agents.py                         130     41     48      1    69%   31-40, 44->53, 52, 104-127, 131-143, 160-161
app\routers\ai.py                              43     18     10      0    55%   29, 33-78
app\routers\crews.py                           40     25     12      0    37%   25-45, 53-65, 77-80
app\routers\dashboard.py                       57      9     12      1    86%   62-64, 79, 81-85
app\routers\engine.py                          24      2      4      1    89%   21-22
app\routers\execution.py                       39      7     16      1    82%   19, 43, 47-48, 54-56
app\routers\llm.py                             39     18      8      0    53%   25-34, 45-74
app\routers\metrics.py                         81      0     24      1    99%   24->26
app\routers\orchestrator.py                    86     23     52      0    76%   12, 17-20, 67-70, 74-75, 86-89, 93-96, 100-103
app\routers\simulator.py                       44      4     14      1    91%   28-29, 60->64, 62-63
app\routers\tasks.py                           16      7      4      0    55%   20-26
app\routers\voice.py                           83     35     20      5    55%   35, 44-67, 81-82, 84-89, 104-105, 109, 116
app\schemas\crew.py                            33      0      2      1    97%   21->exit
app\services\agent_registry.py                155     27     30      6    80%   84, 112-113, 118, 182, 189-190, 193-196, 215, 236-238, 251-259, 276, 278->272, 286-287
app\services\event_bus.py                     169     65     46     13    58%   51-57, 65-67, 79-81, 89-90, 97-99, 105-118, 125-128, 156, 158->144, 159->158, 165-166, 170-172, 177-179, 182-187, 190-193, 201->203, 206-207, 216->218, 220-221, 227-228, 236-237, 244->263, 249, 255-256, 260-261
app\services\execution_service.py              78      9     22      4    87%   37-43, 104, 105->107, 111->113, 115
app\services\key_manager.py                    71      1     16      3    95%   61->65, 97, 99->95
app\services\llm\anthropic.py                  25     16      2      0    33%   8-10, 13-40, 43, 46
app\services\llm\base.py                       12      3      6      0    83%   11, 16, 21
app\services\llm\factory.py                    39      4     16      2    89%   25-27, 38
app\services\llm\ollama.py                     36      8      6      0    76%   54-68
app\services\llm\openai.py                     43     19      6      0    53%   41-57, 64-87
app\services\llm\perplexity.py                 35     14      6      0    56%   36-38, 41-73, 81
app\services\llm_service.py                    72      8     16      3    88%   45, 46->54, 51-53, 87->105, 93-97
app\services\memory_service.py                255     68     80     22    70%   16, 67-71, 80-82, 90-96, 106-109, 139->143, 162-163, 169->178, 175-176, 184, 189-190, 196, 207, 212-213, 218-221, 224->205, 252-253, 259->267, 262-263, 275->277, 278, 279->281, 282, 285, 295-296, 302-305, 316-318, 327, 329, 331, 342-364, 383-386
app\services\metrics_registry.py               37      4     12      1    82%   23-24, 29->32, 35-36
app\services\orchestration\agent_nodes.py      34     26     12      0    17%   10-33, 37-48, 58-66, 75-82
app\services\orchestrator.py                  283     65     68     12    76%   117-118, 154->150, 172->179, 176-177, 184-185, 205->214, 211-212, 224-226, 232-250, 256, 259-260, 269-270, 300-301, 314-315, 328, 335, 345->358, 352-355, 371-372, 384-385, 412-417, 435, 476-477, 488-489, 499-500, 538->552, 542-551, 553-555
app\services\task_chunking_service.py          39     19      8      0    43%   24-115
app\services\voice_service.py                 110     27     28      4    73%   53, 65, 80, 95-109, 114, 132-133, 135-139, 148
app\services\watchdog.py                       57     57     12      0     0%   1-130
---------------------------------------------------------------------------------------
TOTAL                                        3419    779   1048    140    75%

9 files skipped due to complete coverage.
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests/unit/test_event_bus_enhanced.py::test_consume_stream - KeyError:...
FAILED tests/unit/test_llm_service_coverage.py::test_llm_service_init_defaults
=========== 2 failed, 197 passed, 48 warnings in 117.86s (0:01:57) ============
