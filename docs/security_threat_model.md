# Security Threat Model

> **built with WelshDog + BROski ðŸš€ðŸŒ™**

This document outlines the security threat model for HyperCode V2.0, focusing on the risks associated with autonomous code execution and Docker integration.

## System Boundaries
- **Trust Boundary 1:** User <-> Frontend (Authentication required)
- **Trust Boundary 2:** Backend <-> Docker Engine (Critical interface)
- **Trust Boundary 3:** Agent Container <-> External Network (Restricted)

## Identified Threats & Mitigations

### 1. Unrestricted Docker Socket Access
- **Threat:** An attacker compromising the Coder Agent could gain root access to the host machine via the mounted Docker socket (`/var/run/docker.sock`).
- **Severity:** Critical.
- **Mitigation:**
  - **Socket Proxy:** We recommend using a Docker socket proxy (e.g., `tecnativa/docker-socket-proxy`) to whitelist only necessary API calls (e.g., `containers.create`, `containers.start`) and block privileged operations.
  - **Least Privilege:** The Coder Agent runs as a non-root user inside its container.
  - **Validation:** All Docker commands generated by the agent are validated against a strictly allowed schema before execution.

### 2. Arbitrary Code Execution (RCE)
- **Threat:** The Coder Agent executes malicious code generated by the LLM.
- **Severity:** High.
- **Mitigation:**
  - **Ephemeral Containers:** All code execution happens in ephemeral, isolated Docker containers that are destroyed after the task.
  - **Network Isolation:** Execution containers have no internet access unless explicitly whitelisted for package installation.
  - **Resource Limits:** Containers are capped on CPU and RAM to prevent DoS.

### 3. Prompt Injection
- **Threat:** Malicious user input manipulates the Agent to ignore safety constraints.
- **Severity:** Medium.
- **Mitigation:**
  - **System Prompt Hardening:** Core instructions strictly forbid bypassing safety protocols.
  - **Input Sanitization:** All user inputs are sanitized before being fed to the LLM context.

### 4. Data Leakage
- **Threat:** Sensitive environment variables or keys leak into logs or agent outputs.
- **Severity:** High.
- **Mitigation:**
  - **Secret Management:** Secrets are injected at runtime and never stored in code.
  - **Log Scrubbing:** The logging pipeline includes patterns to redact potential keys/tokens.

## Security Checklist
- [x] Docker socket mounted with read-only permissions where possible (or proxied).
- [x] API authentication enabled (JWT).
- [x] HTTPS enabled for all external traffic (in production).
- [x] Regular dependency scanning (trivy/dependabot).

---
> **built with WelshDog + BROski ðŸš€ðŸŒ™**
